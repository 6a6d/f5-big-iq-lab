<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 2.1: Using BIG-IQ AFM Logging to View Centralized Firewall logs</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 2.1: Using BIG-IQ AFM Logging to View Centralized Firewall logs"/>
  <meta name="product" content="F5 BIG-IQ &amp; Cloud Edition Lab"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2019-07-26 04:33:11"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 BIG-IQ &amp; Cloud Edition Lab" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Lab 2.1: Using BIG-IQ AFM Logging to View Centralized Firewall logs &#8212; F5 BIG-IQ &amp; Cloud Edition Lab  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 2.2: Using BIG-IQ Multi-Device Packet and Flow Tracers to test AFM policy" href="lab2.html" />
    <link rel="prev" title="Module 2: Network Tools and Logs" href="module2.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 BIG-IQ & Cloud Edition Lab  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents/Lab:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">Class 1: BIG-IQ Application Management and AS3 (Cloud Edition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">Class 2: BIG-IQ Deployment with auto-scale on AWS, Azure &amp; VMware (Cloud Edition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">Class 3:  BIG-IQ Analytics (Cloud Edition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">Class 4: BIG-IQ Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">Class 5: BIG-IQ Device Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class6/class6.html">Class 6: BIG-IQ ADC Management</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class7.html">Class 7: BIG-IQ Application Firewall Manager (AFM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class8/class8.html">Class 8: BIG-IQ Application Security Manager (ASM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class9/class9.html">Class 9: BIG-IQ Access Policy Manager (APM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class10/class10.html">Class 10: BIG-IQ DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class11/class11.html">Class 11: BIG-IQ DDoS Monitoring and Dashboard</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 2.1: Using BIG-IQ AFM Logging to View Centralized Firewall logs</a><ul>
<li><a class="reference internal" href="#lab-2-1-1-configure-and-use-big-iq-logging-for-afm">Lab 2.1.1: Configure and Use BIG-IQ Logging for AFM</a></li>
<li><a class="reference internal" href="#lab-2-1-2-create-new-application-template-using-firewall-objects">Lab 2.1.2: Create new Application Template Using Firewall objects</a></li>
<li><a class="reference internal" href="#lab-2-1-3-update-existing-application-to-use-new-application-template">Lab 2.1.3: Update Existing Application To Use New Application Template:</a></li>
<li><a class="reference internal" href="#lab-2-1-4-monitoring-firewall-logging-on-big-iq">Lab 2.1.4: Monitoring Firewall Logging On BIG-IQ:</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 BIG-IQ &amp; Cloud Edition Lab</a>
              &gt; <a href="../class7.html">Class 7: BIG-IQ Application Firewall Manager (AFM)</a>
              &gt; <a href="module2.html">Module 2: Network Tools and Logs</a>

          <span class="right">
             <a href="../../_sources/class7/module2/lab1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-big-iq-lab">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-2-1-using-big-iq-afm-logging-to-view-centralized-firewall-logs">
<h1>Lab 2.1: Using BIG-IQ AFM Logging to View Centralized Firewall logs<a class="headerlink" href="#lab-2-1-using-big-iq-afm-logging-to-view-centralized-firewall-logs" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This lab uses firewall objects created on Class 7 Module 1, and also uses previously created application deployments (site36.example.com).  Please verify the application site36.example.com is a currently deployed application in your environment, and complete the steps in Module 1 before proceeding with steps below</p>
</div>
<div class="section" id="lab-2-1-1-configure-and-use-big-iq-logging-for-afm">
<h2>Lab 2.1.1: Configure and Use BIG-IQ Logging for AFM<a class="headerlink" href="#lab-2-1-1-configure-and-use-big-iq-logging-for-afm" title="Permalink to this headline">¶</a></h2>
<p>As of BIG-IQ 6.0, BIG-IQ supports remote log collecting and viewing for AFM policies.  The below steps will take you through the configuration required to support this feature:</p>
<ol class="arabic simple">
<li><p>Under <em>Configuration</em> &gt; <em>Security</em> &gt; <em>Network Security</em>, click <em>Contexts</em></p></li>
<li><p>In the search bar in the upper right corner, search for <code class="docutils literal notranslate"><span class="pre">site36</span></code></p></li>
<li><p>Click the checkbox next to the lock symbol to select both the http and https virtual servers returned from search.</p></li>
<li><p>The <em>Configure Logging</em> button should now be available to click, click it.</p></li>
</ol>
<p>Unlike ASM logging configurations, Network Firewall logging configurations reference a number of system objects including: log publishers, destination, high speed log pools, and associated pool objects.  In order to create a logging profile to logs firewall events, these objects must already exist on the system.  By clicking <em>Configure Logging</em> BIG-IQ will create, if necessary, all the dependent objects and then create the logging profile that creates the objects.  BIG-IQ will display the dialog below, which outlines the objects that are being created:</p>
<a class="reference internal image-reference" href="../../_images/afm_configure_logging_dialog.png"><img alt="../../_images/afm_configure_logging_dialog.png" class="align-center" src="../../_images/afm_configure_logging_dialog.png" style="width: 318.0px; height: 149.5px;" /></a>
<ol class="arabic simple" start="5">
<li><p>Under <em>Configuration</em> &gt; <em>Security</em> &gt; <em>Network Security</em> &gt; <em>Shared Security</em>, click <em>Logging Profiles</em></p></li>
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">afm-remote-logging-profile</span></code> created by BIG-IQ in previous step, the <em>Network Firewall</em> tab on left</p></li>
<li><p>Examine the options set by BIG-IQ when creating the logging profile.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>per <a class="reference external" href="https://support.f5.com/kb/en-us/products/big-iq-centralized-mgmt/manuals/product/big-iq-centralized-management-security-6-0-1/23.html#guid-525b3d56-f673-4569-85a5-0b979cb2cb35">https://support.f5.com/kb/en-us/products/big-iq-centralized-mgmt/manuals/product/big-iq-centralized-management-security-6-0-1/23.html#guid-525b3d56-f673-4569-85a5-0b979cb2cb35</a>, none of the objects created in this manner should be modified.  Need to confirm whether this is the case.  Certainly seems reasonable that a customer would want to tweak these settings to meet their requirements.</p>
</div>
<ol class="arabic simple" start="8">
<li><p>Click <em>Cancel</em></p></li>
</ol>
<p>At this point, we have created all the objects necessary for logging firewall events.  However, we do need to verify that the Data Collection Devices (DCD) being used for this lab have the Network Security Service enabled.  To do this, follow the following steps:</p>
<ol class="arabic simple">
<li><p>We are currently logged in as Larry, the security manager, we need to log out of this role.  Then log in as the admin user.</p></li>
<li><p>Under <em>System</em> &gt; <em>BIG-IQ Data Collection</em>, click <em>BIG-IQ Data Collection Devices</em></p></li>
<li><p>Click on the device <code class="docutils literal notranslate"><span class="pre">bigiq1dcd.example.com</span></code>, and click <em>Services</em> on left side.</p></li>
<li><p>Scroll down to <em>Network Security</em> and verify that service status is <em>Active</em>.  If not, activate.</p></li>
<li><p>Log out of system as Admin, and log back in as Larry.</p></li>
</ol>
</div>
<div class="section" id="lab-2-1-2-create-new-application-template-using-firewall-objects">
<h2>Lab 2.1.2: Create new Application Template Using Firewall objects<a class="headerlink" href="#lab-2-1-2-create-new-application-template-using-firewall-objects" title="Permalink to this headline">¶</a></h2>
<p>In the steps below, we are going to attach our newly created firewall policies to application templates.</p>
<ol class="arabic simple">
<li><p>Under <em>Configuration</em> &gt; <em>Security</em> &gt; <em>Network Security</em>, click <em>Firewall Policies</em></p></li>
<li><p>Click the checkbox next to <code class="docutils literal notranslate"><span class="pre">f5-afm-policy_136</span></code></p></li>
<li><p>Click the dropdown box on the <em>More</em> button and select <em>make available for templates</em>
- the firewall policy is now available for use with application templates on BIG-IQ</p></li>
<li><p>Click <em>Configuration</em> &gt; <em>Security</em> &gt; <em>Shared Security</em>, click <em>Logging Profiles</em></p></li>
<li><p>Click the checkbox next to <code class="docutils literal notranslate"><span class="pre">afm-remote-logging-profile</span></code></p></li>
<li><p>Click the button <em>Make available for templates</em>
- the afm-remote-logging-profile is the logging profile BIG-IQ created for us when we configured logging in the previous exercise.</p></li>
</ol>
<p>With the objects we created available for use with templates, we will now create a new template to use which references these objects.</p>
<p>For the steps below, we will use the <strong>david</strong> (or <strong>marco</strong>) account to manipulate application templates</p>
<ol class="arabic simple">
<li><p>Under <em>Applications</em> &gt; <em>Service Catalog</em></p></li>
<li><p>Check the box next to the <code class="docutils literal notranslate"><span class="pre">Default-f5-HTTPS-WAF-lb-template</span></code>, click the dropdown box on the <em>More</em> button and select <em>Clone</em></p></li>
<li><p>Name the cloned policy <code class="docutils literal notranslate"><span class="pre">Default-f5-HTTPS-WAF-FW-lb-template</span></code></p></li>
<li><p>Once editing the new template, select the <em>Security Policies</em> button</p></li>
<li><p>In the <em>Network Security</em> section, set the Enforced Firewall Policy to <code class="docutils literal notranslate"><span class="pre">f5-afm-policy_136</span></code> for both virtual servers.</p></li>
<li><p>In the <em>Shared Security</em> section, set the Logging Profiles to <code class="docutils literal notranslate"><span class="pre">afm-remote-logging-profile</span></code> for both virtual servers on the Standalone Device.</p></li>
<li><p>Click <em>Save &amp; Close</em></p></li>
<li><p>From the Service Catalog screen, select the template you just created <code class="docutils literal notranslate"><span class="pre">Default-f5-HTTPS-WAF-FW-lb-template</span></code>, the click the <em>Publish</em> button.</p></li>
</ol>
<p>At this point, we have created a new application template that is using our newly created firewall policy and logging profiles.  Next, we will associate an existing application with our new template.</p>
</div>
<div class="section" id="lab-2-1-3-update-existing-application-to-use-new-application-template">
<h2>Lab 2.1.3: Update Existing Application To Use New Application Template:<a class="headerlink" href="#lab-2-1-3-update-existing-application-to-use-new-application-template" title="Permalink to this headline">¶</a></h2>
<p>In previous labs, we have created and deployed a new application using a fresh template.  In this exercise, we are going to update an existing application to use a new template.</p>
<p>Complete the steps below logged in as <strong>david</strong> (or <strong>marco</strong>)</p>
<ol class="arabic">
<li><p>Click the <em>Applications</em> tab, and click the <em>Applications</em> button.</p></li>
<li><p>Click the application <code class="docutils literal notranslate"><span class="pre">site36.example.com</span></code></p></li>
<li><p>In the upper right hand corner, click <em>Switch to Template</em> button</p>
<a class="reference internal image-reference" href="../../_images/switch_to_template.png"><img alt="../../_images/switch_to_template.png" class="align-center" src="../../_images/switch_to_template.png" style="width: 1211.0px; height: 355.0px;" /></a>
</li>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">Default-f5-HTTPS-WAF-FW-lb-template</span></code> we just created.</p></li>
<li><p>In the template editor, in the Domain Names field, type site36.example.com</p></li>
<li><p>Click <em>Save &amp; Close</em>
- This will take a few moments, but the existing application is being re-configured with our updated template, which references our new firewall policy.</p></li>
<li><p>Once the application finishes deploying, click on the application <code class="docutils literal notranslate"><span class="pre">site36.example.com</span></code></p></li>
<li><p>Click the <em>Security</em> label under <em>Application Services</em></p></li>
<li><p>Verify that the Network Firewall policy listed in the Security Configuration summary pane lists <code class="docutils literal notranslate"><span class="pre">f5-afm-policy_136</span></code> as the firewall policy.</p>
<a class="reference internal image-reference" href="../../_images/app_sec_summary.png"><img alt="../../_images/app_sec_summary.png" class="align-center" src="../../_images/app_sec_summary.png" style="width: 1090.0px; height: 468.0px;" /></a>
</li>
</ol>
</div>
<div class="section" id="lab-2-1-4-monitoring-firewall-logging-on-big-iq">
<h2>Lab 2.1.4: Monitoring Firewall Logging On BIG-IQ:<a class="headerlink" href="#lab-2-1-4-monitoring-firewall-logging-on-big-iq" title="Permalink to this headline">¶</a></h2>
<p>In this exercise, we will generate some traffic to be processes by the firewall policy, and use BIG-IQ monitoring to examine the results.</p>
<p>Complete the steps below logged in as <em>Larry</em></p>
<ol class="arabic">
<li><p>Under <em>Monitoring</em> &gt; <em>Events</em> &gt; <em>Network Security</em>, click <em>Firewall</em></p></li>
<li><p>View the current Firewall Event log, in filter box, enter <code class="docutils literal notranslate"><span class="pre">site36</span></code> to filter the log for our test application
- At this point, you probably will not have any events in the log.</p></li>
<li><p>From the <code class="docutils literal notranslate"><span class="pre">Ubuntu</span> <span class="pre">18.04</span> <span class="pre">Lamp</span> <span class="pre">Server</span></code> open an SSH session.</p></li>
<li><p>From the SSH session, run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo nmap -sS 10.1.10.136 -D 10.1.10.7,10.1.10.8,10.1.10.9,5.188.11.1,5.188.11.2</span>
</pre></div>
</div>
<p>This will use the nmap program to scan our test application using several different source addresses.  Our firewall policy will not allow all of the sources.</p>
</li>
<li><p>Refresh the Firewall Event Log.  This time you should see a number of events in the firewall log.</p></li>
<li><p>Click one of the events, and examine the details available</p>
<a class="reference internal image-reference" href="../../_images/firewall_log_drop.png"><img alt="../../_images/firewall_log_drop.png" class="align-center" src="../../_images/firewall_log_drop.png" style="width: 1167.0px; height: 650.0px;" /></a>
</li>
</ol>
<p>Why is the Firewall Event log not showing accepted connections, only drops?</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>check the remote-afm-logging-profile</p>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="module2.html" title="Module 2: Network Tools and Logs" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab2.html" title="Lab 2.2: Using BIG-IQ Multi-Device Packet and Flow Tracers to test AFM policy" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/clouddocs.js"></script>
  <script src="/assets/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>