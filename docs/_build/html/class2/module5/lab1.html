<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 5.1: Prepare your Azure deployment</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 5.1: Prepare your Azure deployment"/>
  <meta name="product" content="F5 BIG-IQ &amp; Cloud Edition Lab"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2019-07-26 04:33:11"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 BIG-IQ &amp; Cloud Edition Lab" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Lab 5.1: Prepare your Azure deployment &#8212; F5 BIG-IQ &amp; Cloud Edition Lab  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 5.2: Deploy our SSG in Azure" href="lab2.html" />
    <link rel="prev" title="Module 5: Setup a Service scaling group (SSG) in Azure" href="module5.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 BIG-IQ & Cloud Edition Lab  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents/Lab:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">Class 1: BIG-IQ Application Management and AS3 (Cloud Edition)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class2.html">Class 2: BIG-IQ Deployment with auto-scale on AWS, Azure &amp; VMware (Cloud Edition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">Class 3:  BIG-IQ Analytics (Cloud Edition)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">Class 4: BIG-IQ Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">Class 5: BIG-IQ Device Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class6/class6.html">Class 6: BIG-IQ ADC Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class7/class7.html">Class 7: BIG-IQ Application Firewall Manager (AFM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class8/class8.html">Class 8: BIG-IQ Application Security Manager (ASM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class9/class9.html">Class 9: BIG-IQ Access Policy Manager (APM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class10/class10.html">Class 10: BIG-IQ DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class11/class11.html">Class 11: BIG-IQ DDoS Monitoring and Dashboard</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 5.1: Prepare your <code class="docutils literal notranslate"><span class="pre">Azure</span></code> deployment</a><ul>
<li><a class="reference internal" href="#setting-up-a-service-principal-account">Setting up a Service Principal Account</a></li>
<li><a class="reference internal" href="#subscribe-to-the-big-ip-instance-in-the-azure-marketplace">Subscribe to the BIG-IP instance in the <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">MArketplace</span></code></a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 BIG-IQ &amp; Cloud Edition Lab</a>
              &gt; <a href="../class2.html">Class 2: BIG-IQ Deployment with auto-scale on AWS, Azure &amp; VMware (Cloud Edition)</a>
              &gt; <a href="module5.html">Module 5: Setup a Service scaling group (SSG) in Azure</a>

          <span class="right">
             <a href="../../_sources/class2/module5/lab1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-big-iq-lab">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-5-1-prepare-your-azure-deployment">
<h1>Lab 5.1: Prepare your <code class="docutils literal notranslate"><span class="pre">Azure</span></code> deployment<a class="headerlink" href="#lab-5-1-prepare-your-azure-deployment" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The SSG will be automatically delete 23h after the deployment was started.</p>
</div>
<p>In module1/Lab 1.1, we saw the different components to setup a SSG:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Pool</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Pools</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">Template</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Provider</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cloud</span> <span class="pre">Environment</span></code></p></li>
</ul>
<p>When you want to deploy a <code class="docutils literal notranslate"><span class="pre">SSG</span></code> in <code class="docutils literal notranslate"><span class="pre">Azure</span></code>, you don’t need to provide the same amount of information:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">License</span> <span class="pre">Pool</span></code> is not mandatory. We are free to use <code class="docutils literal notranslate"><span class="pre">Utility</span> <span class="pre">Billing</span></code> (pay-per-use) in <code class="docutils literal notranslate"><span class="pre">AZURE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Pools</span></code> are not needed. When we deploy a <code class="docutils literal notranslate"><span class="pre">SSG</span></code> in <code class="docutils literal notranslate"><span class="pre">AZURE</span></code>, the deployed <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Edition(s)</span></code>
will be using our single NIC deployment. It means that we use one interface for management and traffic
processing. In this case, the IP Address assigned to the device will be picked automatically by <code class="docutils literal notranslate"><span class="pre">AZURE</span></code></p></li>
</ul>
<p>To deploy our <code class="docutils literal notranslate"><span class="pre">SSG</span></code> in <code class="docutils literal notranslate"><span class="pre">Azure</span></code>, we will need to do a few things:</p>
<ul class="simple">
<li><p>Setup an <code class="docutils literal notranslate"><span class="pre">Service</span> <span class="pre">Principal</span> <span class="pre">Account</span></code> that will allow us to setup our <code class="docutils literal notranslate"><span class="pre">SSG</span></code> via
the <code class="docutils literal notranslate"><span class="pre">Azure</span></code> API</p></li>
</ul>
<p>Once this is done, we will be able to deploy our <code class="docutils literal notranslate"><span class="pre">SSG</span></code>. We will rely on some ansible scripts to:</p>
<ul class="simple">
<li><p>Create a VNET, subnets, …</p></li>
<li><p>Deploy an APP in <code class="docutils literal notranslate"><span class="pre">Azure</span></code></p></li>
<li><p>Setup an <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">VPN</span></code> connection between our <code class="docutils literal notranslate"><span class="pre">UDF</span></code> environment and this newly deployed <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">VNET</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>in this lab, we consider that you have access to <code class="docutils literal notranslate"><span class="pre">Azure</span></code>. We won’t cover this topic.</p>
</div>
<div class="section" id="setting-up-a-service-principal-account">
<h2>Setting up a Service Principal Account<a class="headerlink" href="#setting-up-a-service-principal-account" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Needs to be done by an admin in the subscription</p>
</div>
<ol class="arabic simple">
<li><p>Registering an application</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>On the Azure portal, go to Azure Active Directory → App registrations</p></li>
<li><p>Click on “+ New registration”</p></li>
<li><p>Enter the following values
Name: &lt;Name of the application&gt;</p></li>
<li><p>Click Create</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_1a.png"><img alt="../../_images/img_module5_lab1_1a.png" class="align-center" src="../../_images/img_module5_lab1_1a.png" style="width: 1434.5px; height: 739.5px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><ul class="simple">
<li><p>Click on Certificates &amp; secrets → New client secret</p></li>
<li><p>Enter a Description and select Expiration period.</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_1b.png"><img alt="../../_images/img_module5_lab1_1b.png" class="align-center" src="../../_images/img_module5_lab1_1b.png" style="width: 1435.5px; height: 787.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Adding additional Application Owners</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>On the Azure portal, go to Azure Active Directory → App registrations → &lt;the app you created in Registering an application&gt;</p></li>
<li><p>Click on Settings → Owners → Add owner</p></li>
<li><p>Enter the user’s F5 email address to search</p></li>
<li><p>Select the user and Click on Select</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_2.png"><img alt="../../_images/img_module5_lab1_2.png" class="align-center" src="../../_images/img_module5_lab1_2.png" style="width: 774.5px; height: 355.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Generating Service Principal Secret</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>On the Azure portal, go to Azure Active Directory → App registrations → &lt;the app you created in Registering an application&gt;</p></li>
<li><p>Click on Settings → Keys</p></li>
<li><p>Enter the user’s name in the Description field and select “Never Expires” for the duration</p></li>
<li><p>Click on Save</p></li>
<li><p>Copy the Value field and save it somewhere. This will need to be provided to the user to be able to configure an Azure provider in BIG-IQ</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_3.png"><img alt="../../_images/img_module5_lab1_3.png" class="align-center" src="../../_images/img_module5_lab1_3.png" style="width: 891.0px; height: 356.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Granting access control to the application</p></li>
</ol>
<ul class="simple">
<li><p>On the Azure portal, go to Azure Active Directory → All Services</p></li>
<li><p>Click on Subscriptions</p></li>
<li><p>Click on the subscription that you are using for the application</p></li>
<li><p>Click on Access Control (IAM)</p></li>
<li><p>Click on Add</p></li>
<li><p>Select Role Assignment</p></li>
<li><p>Select “Contributor” in the drop down for the Role</p></li>
<li><p>Type in the Application name created in Step 1.</p></li>
<li><p>Click on Save</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_4.png"><img alt="../../_images/img_module5_lab1_4.png" class="align-center" src="../../_images/img_module5_lab1_4.png" style="width: 953.0px; height: 438.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Credentials needed for configuring Azure Provider in BIG-IQ</p></li>
</ol>
<p>The following pieces of information is needed to configure an Azure Provider.
This information is required to make API calls to Azure for resource CRUD operations, either through Java or through Ansible.</p>
<ul class="simple">
<li><p><strong>Subscription Id</strong>: You can get this by clicking on Subscriptions in Azure portal and copying the Subscription Id for the f5-AZR_7801_PTG_MANOVA-Dev subscription</p></li>
<li><p><strong>Tenant Id</strong>: Go to Azure Active Directory → Properties and copy the value of the Directory ID. This is the tenant Id.</p></li>
<li><p><strong>Client Id</strong>: Go to Azure Active Directory → App registrations and copy the value of the Application ID. This is the client ID.</p></li>
<li><p><strong>Service Principal Secret</strong>: Copy the value saved in step 5 of Generating Service Principal Secret</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>we need something unique for the User name since other student will do the lab and you may use
same Azure corporate account.</p>
</div>
</div>
<div class="section" id="subscribe-to-the-big-ip-instance-in-the-azure-marketplace">
<h2>Subscribe to the BIG-IP instance in the <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">MArketplace</span></code><a class="headerlink" href="#subscribe-to-the-big-ip-instance-in-the-azure-marketplace" title="Permalink to this headline">¶</a></h2>
<p>Before being able to deploy an instance in <code class="docutils literal notranslate"><span class="pre">Azure</span></code>, you’ll have to <strong>subscribe</strong> to this license agreement</p>
<p>Go here to <strong>subscribe</strong> to the right F5 instance we will use in this lab:</p>
<p><a class="reference external" href="https://portal.azure.com/#blade/Microsoft_Azure_Marketplace/GalleryFeaturedMenuItemBlade/selectedMenuItemId/home/searchQuery/f5-bigip/resetMenuId/">F5 BIG-IP VE – ALL (BYOL, 1 Boot Location)</a></p>
<p>Once you’ve subscribed, you should see something like this:</p>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_5.png"><img alt="../../_images/img_module5_lab1_5.png" class="align-center" src="../../_images/img_module5_lab1_5.png" style="width: 1918.5px; height: 940.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/img_module5_lab1_6.png"><img alt="../../_images/img_module5_lab1_6.png" class="align-center" src="../../_images/img_module5_lab1_6.png" style="width: 1920.0px; height: 940.5px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="module5.html" title="Module 5: Setup a Service scaling group (SSG) in Azure" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab2.html" title="Lab 5.2: Deploy our SSG in Azure" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/clouddocs.js"></script>
  <script src="/assets/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>