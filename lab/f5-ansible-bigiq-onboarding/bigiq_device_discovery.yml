---
  - hosts: f5-bigip
    connection: local
    serial: 1
    gather_facts: false
    vars:
      bigiq_ip: "{{ hostvars[groups['f5-bigiq-cm'][0]]['ansible_host'] }}"
      bigiq_password: "{{ hostvars[groups['f5-bigiq'][0]]['bigiq_onboard_new_admin_password'] }}"

    roles:
      - f5devcentral.f5ansible
    tasks:
    - name: discover and Import BIG-IP in BIG-IQ
      bigiq_device_discovery:
        provider:
          server: "{{ bigiq_ip }}"
          user: admin
          password: "{{ bigiq_password }}"
          validate_certs: no
        device_address: "{{ device_address }}"
        device_username: "{{ device_username }}"
        device_password: "{{ device_password }}"
        modules: "{{ modules | list }}"
        conflict_policy: "{{ conflict_policy }}"
        statistics:
          enable: "{{ enable }}"
          stat_modules: "{{ stat_modules | list }}"
        ha_name: "{{ ha_name }}"
        force: yes
      delegate_to: localhost
    tags: bigip